% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sckmer.R
\name{sckmer}
\alias{sckmer}
\title{Quantify K-mers and UMI Data by Taxon}
\usage{
sckmer(
  kreport,
  koutput,
  reads,
  extract_kreport = NULL,
  extract_kmer = NULL,
  extract_umi = NULL,
  barcode_extractor = NULL,
  umi_extractor = NULL,
  ranks = c("G", "S"),
  kmer_len = 35L,
  min_frac = 0.5,
  exclude = "9606",
  threads = NULL,
  odir = NULL
)
}
\arguments{
\item{koutput}{Path to the extracted Kraken2 output file, typically
filtered using \code{\link[=kractor]{kractor()}}.}

\item{reads}{A character vector of extracted FASTA files (from
\code{\link[=kractor]{kractor()}}). Can be one file (single-end) or two files (paired-end).}

\item{extract_kreport}{Path to the file where the extracted Kraken2 report,
matched to \code{koutput}, will be saved. Defaults to
\code{"kraken_microbiome_report.txt"}.}

\item{extract_kmer}{Path to the file where the quantified k-mer data,
derived from \code{koutput}, will be saved. Defaults to
\code{"kraken_microbiome_kmer.txt"}.}

\item{extract_umi}{Path to the file where the quantified UMI data,
derived from \code{koutput}, will be saved. Defaults to
\code{"kraken_microbiome_umi.txt"}.}

\item{barcode_extractor, umi_extractor}{A function takes sequence IDs, read1,
read2 and return a character corresponding to cell barcode and UMI
respectively, each should have the same length of the input.}

\item{ranks}{Taxa ranks to analyze.}

\item{kmer_len}{Kraken kmer length. Default: \code{35L}, which is the default kmer
size of kraken2.}

\item{min_frac}{Minimum fraction of kmers directly assigned to taxid to use
read. Reads with \verb{<=min_frac} of the k-mers map inside the taxon's lineage
are also discarded.}

\item{exclude}{A character of taxid to exclude, for \code{SAHMI}, the host taxid.
Reads with any k-mers mapped to the \code{exclude} are discarded.}

\item{threads}{Integer. Number of threads to use. Default to all
available threads.}
}
\value{
None. This function generates the following files:
\itemize{
\item \code{extract_kreport}: A filtered version of the Kraken2 taxonomic report,
containing only taxa that meet the \code{ranks} criteria and are observed in
\code{koutput}. Used by \code{\link[=rpmm_quantile]{rpmm_quantile()}} and \code{\link[=slsd]{slsd()}}.
\item \code{extract_kmer}: A table quantifying total and unique k-mers assigned to
each taxon across barcodes. Used by \code{\link[=blsd]{blsd()}}.
\item \code{extract_umi}: A table of taxon–barcode–UMI combinations indicating all
observed UMI-tagged reads per taxon. Used by \code{\link[=taxa_counts]{taxa_counts()}}.
}
}
\description{
This function counts total and unique k-mers per taxon across cell barcodes,
using both the cell barcode and unique molecular identifier (UMI) to resolve
read identity at the single-cell level. It aggregates k-mer counts for each
taxonomic rank of interest (by default, genus and species), including all
descendant taxa within those ranks.
}
\examples{
\dontrun{
# 1. `kreport` should be the output of `blit::kraken2()`.
# 2. `koutput` should be the extracted kraken2 output by `kractor()`
# 3. `reads` should be the output of `kractor()`
sckmer(
    kreport = "kraken_report.txt",
    koutput = "kraken_microbiome_output.txt",
    reads = "kraken_microbiome_reads.fa",
    # if you use paired reads.
    # reads = c(
    #   "kraken_microbiome_reads_1.fa",
    #   "kraken_microbiome_reads_2.fa"
    # ),
    odir = NULL
)
}
}
\seealso{
\url{https://github.com/sjdlabgroup/SAHMI}
}
